<nb-card class="h-100">
  <nb-card-header>
    在线咨询
    <button mat-icon-button color="accent" class="d-md-none">
      <mat-icon>menu</mat-icon>
    </button>
  </nb-card-header>

  <nb-card-body class="container-fluid" id="wrapper">
    <div class="row">
      <div class="d-none d-md-block col-md-4 col-xl-3">
        <div class="h6 pl-3 py-2">
          <mat-icon color="primary" class="pr-3">people</mat-icon> 我的患者
        </div>

        <mat-accordion *ngIf="doctorGroups?.length" class="doctor-group">
          <mat-expansion-panel *ngFor="let dg of doctorGroups" class="p-0">
            <mat-expansion-panel-header>
              <mat-panel-title>
                {{dg.name}}
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="doctor-group-body" [style.maxHeight]="groupBodyHeight">
              <mat-selection-list [multiple]="false">
                <mat-list-option *ngFor="let member of getGroupMembers(dg._id)" (click)="selectChatPatient(member.user)">
                  <div mat-list-icon><img [src]="member.user.icon" alt="头像" class="avatar"></div>
                  <div class="pl-4">
                    {{member.user.name}}
                    <div class="text-hint"> {{member.user.gender | gender}} </div>
                  </div>
                </mat-list-option>
              </mat-selection-list>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>

      <div class="col-12 col-md-8 col-xl-9">
        <div class="card" [style.height]="chatBodyHeight" *ngIf="selectedPatient">
          <div class="card-header msg_head">
            <div class="d-flex bd-highlight">
              <div class="img_cont">
                <img [src]="selectedPatient?.icon" class="rounded-circle user_img">
                <span class="online_icon"></span>
              </div>
              <div class="user_info">
                <span>{{ selectedPatient?.name }}</span>
                <p>
                  {{ selectedPatient?.gender | gender }} &nbsp;&nbsp;
                  {{ selectedPatient?.birthdate ? '年龄：' + (selectedPatient.birthdate | localDate: 'age') : '' }} <br>
                  {{ selectedPatient?.cell ? '电话：' + selectedPatient.cell : '' }}
                </p>
              </div>
            </div>
          </div>

          <div class="card-body msg_card_body">
            <div *ngFor="let chat of chats" class="mb-2" [ngClass]="chat.sender === doctor._id ? ' sender': 'to'">

              <div class="d-flex"
                [ngClass]="chat.sender === doctor._id ? 'align-items-end flex-row-reverse': 'align-items-start flex-row'">
                <div class="img_cont_msg">
                  <img [src]="selectedPatient?.icon" class="rounded-circle user_img_msg">
                </div>
                <div class="msg-data">
                  {{ chat.data }}
                </div>
              </div>
              <div class="msg-time">{{chat.created | localDate: 'time'}}</div>
            </div>
            <div id="chat-bottom"></div>
          </div>

          <div class="align-bottom d-flex text-right w-100 px-3 py-1">
            <textarea type="text" nbInput fullWidth autocomplete="off" fieldSize="small" placeholder="请输入..."
              cdkFocusInitial (keyup.enter)="send()" [(ngModel)]="myInput"></textarea>
            <button nbButton hero status="info" size="small" nbSuffix (click)="send()">
              <nb-icon icon="paper-plane-outline" pack="eva"></nb-icon>
            </button>
          </div>
        </div>
      </div>
    </div>


    <div class="row justify-content-center h-100" [class.d-none]="true">

          <div class="card-footer">
            <div class="input-group">
              <div class="input-group-append">
                <span class="input-group-text attach_btn"><i class="fas fa-paperclip"></i></span>
              </div>
              <textarea name="" class="form-control type_msg" placeholder="Type your message..."></textarea>
              <div class="input-group-append">
                <span class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></span>
              </div>
            </div>
          </div>
        </div>

  </nb-card-body>
</nb-card>
